# 事例検索RAGシステム - 画面モック

公共提案で使用する事例検索RAGシステムの画面モックです。実際のRAG機能は実装されていませんが、画面の挙動を確認できるよう最低限の機能を実装しています。

## 技術スタック

- **React 18** + **TypeScript**
- **Tailwind CSS** - スタイリング
- **React Router** - 画面遷移
- **Vite** - ビルドツール

## 実装済み機能

### 1. メイン画面（検索） - `/`

**チャット機能**
- テキスト入力とメッセージ送信
- チャット履歴の表示とスクロール
- Enterキーでの送信対応
- 検索中の状態表示

**検索機能**
- **フリーテキスト検索**: キーワードによる簡易検索（ファイル名、本文、タグから検索）
- **タグフィルター検索**: 複数タグを選択して絞り込み検索（AND条件）
- **ハイブリッド検索**: フリーテキストとタグフィルターの併用が可能
- 検索結果のリアルタイム表示
- 結果件数の表示
- 検索実行前の初期表示メッセージ
- 検索結果が0件の場合の適切な表示

**タグフィルター機能**
- 7つの登録済みタグから選択可能
- 複数タグの同時選択に対応
- 選択タグの「すべてクリア」ボタン
- 選択状態の視覚的フィードバック

**検索結果表示**
- カード形式での結果表示
- ファイル名、ページ番号、該当テキスト
- タグの表示（モノクロデザイン）
- アップロード日時の表示
- ファイルを開くボタン

### 2. ファイル管理画面 - `/files`

**ファイルアップロード**
- ドラッグ&ドロップでのファイル追加
- ファイル選択ダイアログからの追加
- 複数ファイルの同時アップロード対応
- アップロードされたファイルは自動で「公共」タグが付与

**ファイル管理**
- アップロード済みファイル一覧の表示
- ファイルの削除機能
- ファイルサイズの表示
- アップロード日時の表示

**タグ管理**
- 新規タグの追加（モーダルから登録）
- 既存タグの削除
- タグ削除時、関連ファイルからも自動削除
- Enterキーでのタグ追加対応
- **Dify API連携**:
  - タグ管理モーダルを開くと自動的にDifyから最新のタグ一覧を取得
  - タグ追加時にDify APIへメタデータを自動登録
  - タグ追加成功後、自動的にタグ一覧を再取得
- ローディング状態表示とエラーハンドリング

**ファイルへのタグ付け**
- ファイルごとのタグ編集モード
- 複数タグの選択/選択解除
- タグの保存/キャンセル機能
- タグの統一されたモノクロ表示

## セットアップ方法

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 環境変数の設定

Dify APIとの連携のため、環境変数を設定します:

```bash
# .env.exampleをコピーして.envファイルを作成
cp .env.example .env
```

`.env`ファイルを編集し、以下の値を設定してください:

```env
# Dify API Base URL
VITE_DIFY_API_BASE_URL=https://api.dify.ai/v1

# Dify Dataset ID (タグ管理で使用)
VITE_DIFY_DATASET_ID=your-dataset-id-here

# Dify API Bearer Token
VITE_DIFY_API_KEY=your-api-key-here
```

**注意:** `.env`ファイルはGit管理から除外されています。APIキーは絶対に公開しないでください。

### 3. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで http://localhost:5173 にアクセスしてください。

### プロダクションビルド

```bash
npm run build
```

ビルド結果は `dist` ディレクトリに出力されます。

### プレビュー

```bash
npm run preview
```

## プロジェクト構成

```
src/
├── components/       # 共通コンポーネント
│   ├── Layout.tsx   # レイアウト・ナビゲーション
│   ├── Modal.tsx    # モーダルコンポーネント
│   └── TagBadge.tsx # タグ表示コンポーネント
├── pages/           # 画面コンポーネント
│   ├── ChatSearch.tsx      # メイン検索画面
│   └── FileManagement.tsx  # ファイル管理画面
├── services/        # API連携
│   └── difyApi.ts   # Dify API通信機能
├── types/           # TypeScript型定義
│   └── index.ts
├── data/            # ダミーデータ
│   └── dummyData.ts
├── App.tsx          # ルーティング設定
├── main.tsx         # エントリーポイント
└── index.css        # グローバルスタイル
```

## デザインコンセプト

### 基本方針
- 業務システムらしい落ち着いた配色
- **グレースケール中心**のミニマルなデザイン
- 過度な装飾を排除したプロフェッショナルな見た目
- 公共機関向け提案に適した信頼感のある印象
- AIツール感を排除した、人が作った感のあるデザイン

### カラーパレット
- **ベース**: 白（bg-white）、ライトグレー（bg-gray-50）
- **テキスト**: ダークグレー（text-gray-900, text-gray-700）
- **アクセント**: ブラック（bg-gray-900）- ボタンや選択状態
- **ボーダー**: グレー（border-gray-200, border-gray-300）
- **ホバー**: 控えめなグレーの変化（hover:bg-gray-800など）

### UI要素の特徴
- **ナビゲーション**: タブ形式、下線で現在位置を表示
- **タグ**: 全て統一されたグレー表示（カラフルさを排除）
- **ボタン**: ダークグレー/ブラック系で統一
- **アイコン**: 必要最小限に抑制、テキストベース優先
- **角丸**: 控えめ（4px〜8px）
- **シャドウ**: 最小限（主にボーダーで表現）
- **フォントサイズ**: 視認性の高いサイズ設定

## 使い方

### 検索画面での操作

1. **フリーテキスト検索を試す**
   - 入力欄に「DX」「システム」「クラウド」「オンライン」などのキーワードを入力
   - 送信ボタンまたはEnterキーで検索実行
   - 右側に検索結果が表示されます

2. **タグフィルター検索を試す**
   - 「タグで絞り込み」セクションからタグを選択（複数選択可能）
   - 選択したタグをクリックすると選択/解除を切り替え
   - タグのみでも検索可能
   - 「すべてクリア」で選択を一括解除

3. **ハイブリッド検索**
   - タグを選択してからキーワードを入力
   - フリーテキストとタグの両方の条件で絞り込まれます
   - 例：「#公共」「#DX」を選択 + 「オンライン」で検索

4. **検索のヒント**
   - 複数のキーワードをスペース区切りで入力可能
   - ファイル名、本文、タグから検索されます
   - 該当結果がない場合はエラーメッセージが表示されます
   - タグは検索後もクリアされないため、連続検索が便利です

### ファイル管理画面での操作

1. **ファイルをアップロード**
   - 点線枠内にファイルをドラッグ&ドロップ
   - または「ファイルを選択」ボタンからファイルを選択
   - アップロードされたファイルは一覧の最上部に追加されます

2. **タグを管理**
   - 右上の「タグ管理」ボタンをクリックしてモーダルを開く
   - モーダル内で新しいタグを追加
   - 登録済みタグの×ボタンで削除可能
   - 「閉じる」ボタンまたは×ボタンでモーダルを閉じる

3. **ファイルにタグを付ける**
   - ファイル一覧の「タグ編集」ボタンをクリック
   - タグを選択/選択解除して「保存」ボタンで確定

4. **ファイルを削除**
   - 各ファイルの「削除」ボタンをクリック

## ダミーデータ

初期状態で以下のダミーデータが含まれています：

- **アップロード済みファイル（9件）:**
  - 大阪市DX推進計画_2023.pdf
  - 厚生労働省システム更改提案書.docx
  - 地方自治体向けDX事例集_2022.pdf
  - クラウド移行計画書_愛知県.pdf
  - セキュリティ対策報告書_2024.pdf
  - AI活用事例_自治体向け.pdf
  - 業務改善提案書_RPA導入.docx
  - データ分析基盤構築計画.pdf
  - DX推進コンサルティング報告書.pdf

- **登録済みタグ（14個）:**
  - #公共、#自治体、#2022、#2023、#2024
  - #調査研究、#システム開発、#DX
  - #クラウド、#セキュリティ、#データ分析
  - #AI・機械学習、#業務効率化、#コンサルティング

- **検索結果データ（20件）:**
  - 各ファイルから複数の検索可能なテキストを収録
  - 実在の自治体名を使用（大阪市、横浜市、神奈川県、福岡市、愛知県など）
  - 様々なタグの組み合わせで検索結果が表示される

- **検索可能なキーワード例:**
  - DX、システム、クラウド、オンライン、調査研究、自治体
  - AI、機械学習、セキュリティ、データ分析、RPA
  - コンサルティング、業務効率化 など

**注:** 初期状態ではチャット履歴と検索結果は空です。検索を実行すると結果が表示されます。初期表示では「検索を実行すると結果がここに表示されます」というメッセージが表示され、検索前に「0件の結果」と表示されることはありません。

## 最近の改善点

### UI/UXの改善（2025年12月実施）

1. **ナビゲーションの改善**
   - タイトルの横から**下部**に移動し、視認性を向上
   - タブ形式のナビゲーションで現在位置が明確に
   - カラフルな青色を廃止し、シンプルな黒系の下線で表示

2. **タグデザインの統一**
   - カラフルな色分けを廃止し、**全てグレー**に統一
   - プロフェッショナルで落ち着いた見た目に
   - 一貫性のあるデザイン言語

3. **検索機能の拡張と改善**
   - タグフィルター機能を追加（複数選択可能）
   - フリーテキストとタグの併用検索に対応
   - 初期表示時の不適切な「0件」表示を修正
   - **タグ選択時の挙動改善**:
     - 選択したタグが入力フォームに`#タグ名`形式で表示される
     - タグ選択中は入力フォームが非活性化（編集不可）
     - チャットメッセージに`#タグ名`形式で表示
   - タグ検索ロジックの修正により、全てのタグで確実に結果が表示される

4. **全体的なデザイン改善**
   - 不要なアイコンを削減し、テキストベースに
   - 青色のアクセントカラーを廃止、グレースケール中心に
   - ボタンやリンクを黒/グレー系に統一
   - AIツール感を排除したプロフェッショナルなデザイン

5. **データの充実化**
   - タグ数を7個→14個に増加（2024、クラウド、セキュリティ等を追加）
   - アップロード済みファイルを4件→9件に増加
   - 検索結果データを7件→20件に拡充
   - プレースホルダー名を実在の自治体名に変更
     - 〇〇市 → 大阪市
     - △△省 → 厚生労働省
     - XX県 → 愛知県
     - A市 → 横浜市
     - B県 → 神奈川県
     - C市 → 福岡市

6. **レイアウトの最適化**
   - チャット入力欄が常に画面下部に固定表示
   - スクロール不要で入力欄にアクセス可能

## 注意事項

- このモックはUIの見た目と基本的な挙動の確認を目的としています
- 実際のRAG機能（AI検索）は実装されておらず、簡易的なキーワードマッチングのみです
- データはブラウザのメモリ上のみで保持され、リロードすると初期状態に戻ります
- ファイルアップロードは見た目のみで、実際のファイルはサーバーに保存されません
- バックエンドとの連携（Dify等）は別途実装する想定です

## Dify API連携機能

### タグ管理のAPI連携

タグ管理機能でDify APIと完全に連携し、Difyに登録されているタグの表示・追加を行います。

**実装ファイル:**
- [src/services/difyApi.ts](src/services/difyApi.ts) - API通信処理
- [src/pages/FileManagement.tsx](src/pages/FileManagement.tsx) - タグ管理処理

**主な機能:**

1. **タグ一覧の取得** (GET `/datasets/{dataset_id}/metadata`)
   - タグ管理モーダルを開くたびに、Difyから最新のタグ一覧を自動取得
   - ローディング表示: 「Difyからタグを読み込んでいます...」
   - 取得したタグをリアルタイムで画面に表示

2. **タグの追加** (POST `/datasets/{dataset_id}/metadata`)
   - モーダルでタグ名を入力し「追加」ボタンをクリック
   - Dify APIに以下の形式でPOSTリクエストを送信:
     ```json
     {
       "type": "string",
       "name": "タグ名"
     }
     ```
   - 追加成功後、自動的にタグ一覧を再取得して最新状態を表示
   - 成功/失敗のメッセージをアラート表示

**エラーハンドリング:**
- API設定が未完了の場合はエラーメッセージを表示
- ネットワークエラーやAPIエラーをキャッチし、適切なメッセージを表示
- タグ読み込み中/作成中はボタンが無効化され、状態を表示

**必要な設定:**
`.env`ファイルに以下の環境変数を設定してください:
- `VITE_DIFY_API_BASE_URL` - Dify APIのベースURL
- `VITE_DIFY_DATASET_ID` - データセットID
- `VITE_DIFY_API_KEY` - APIキー(Bearer Token)

## 今後の実装予定

実際のシステム化に向けては以下の実装が必要です：

1. バックエンドAPI連携（Dify等）
2. ファイルアップロード・ストレージ連携
3. 検索機能の実装（RAG）
4. タグの永続化・管理機能
5. 認証・権限管理
6. エラーハンドリング
