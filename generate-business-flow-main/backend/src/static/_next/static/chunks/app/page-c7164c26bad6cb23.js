(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{67:function(){},2061:function(){},6954:function(e,t,n){Promise.resolve().then(n.bind(n,227))},227:function(e,t,n){"use strict";n.d(t,{default:function(){return m}});var r=n(7437),a=n(2265),l=n(4484);function i(e){let{id:t="chat-messages",messages:n}=e,l=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=l.current;e&&(e.scrollTop=e.scrollHeight)},[n]),(0,r.jsx)("div",{id:t,ref:l,style:{display:"flex",flexDirection:"column",flex:1,overflowY:"auto",padding:16,border:"1px solid rgba(209, 213, 219, 0.3)",borderRadius:12,marginBottom:3,background:"rgba(249, 250, 251, 0.5)"},children:n.map(e=>(0,r.jsx)("div",{style:{display:"flex",justifyContent:"user"===e.role?"flex-end":"flex-start",width:"100%"},children:(0,r.jsxs)("div",{className:"chat-message ".concat(e.role),style:{padding:"10px 12px",marginBottom:8,borderRadius:10,background:"user"===e.role?"#e5f6ffff":"#eef2ffbd",border:"1px solid rgba(209, 213, 219, 0.4)",maxWidth:"80%",boxShadow:"0 1px 2px rgba(0,0,0,0.04)",textAlign:"left",marginLeft:"user"===e.role?"auto":0,marginRight:"user"===e.role?0:"auto"},children:[(0,r.jsx)("div",{style:{fontSize:13,marginBottom:4,color:"#4b5563"},children:e.content}),(0,r.jsx)("div",{style:{fontSize:11,color:"#9ca3af",textAlign:"right"},children:new Date(e.sentAt).toLocaleTimeString()})]})},e.id))})}function s(e){let{agentState:t,setAgentState:n,prompt:s,onPromptChange:o,onClear:c,onGenerate:d,attachments:u,onAttachmentsChange:m}=e,[f,p]=(0,a.useState)([]),[h,x]=(0,a.useState)(!1),g=async e=>{if(!e||0===e.length)return;let t=["pdf","txt","md","csv","docx","xls","xlsx"],n=[];for(let i of Array.from(e)){var r,a;let e=null!==(a=null===(r=i.name.split(".").pop())||void 0===r?void 0:r.toLowerCase())&&void 0!==a?a:"";if(t.includes(e)&&!(i.size>2097152))try{let{content:e,encoding:t}=await (0,l.z1)(i);n.push({id:"".concat(i.name,"-").concat(Date.now(),"-").concat(Math.random().toString(36).slice(2)),file:i,content:e,encoding:t}),console.log(e)}catch(e){console.error("添付ファイルの読み込みに失敗しました",e)}}n.length>0&&m(e=>[...e,...n])},w=e=>{m(t=>t.filter(t=>t.id!==e))},y=e=>e<1024?"".concat(e,"B"):e<1048576?"".concat((e/1024).toFixed(1),"KB"):"".concat((e/1048576).toFixed(1),"MB");return(0,a.useEffect)(()=>{let e=null;if("generated"===t?e="生成が完了しました。結果を確認してください。":"generating"===t?e="生成中です。しばらくお待ちください。":"inputWaiting"===t&&(e="生成したい業務フローに関連するファイルを添付し、指示を入力してください。"),!e)return;let n={id:"system-".concat(Date.now()),role:"system",content:e,sentAt:new Date().toISOString()};p(e=>[...e,n])},[t]),(0,r.jsx)("div",{className:"chat-section",id:"chat-section",children:(0,r.jsxs)("div",{className:"panel",id:"chat-panel",children:[(0,r.jsxs)("div",{className:"panel-header",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("i",{className:"fas fa-comments"})," BiT-Flow チャット"]}),(0,r.jsx)("span",{className:"panel-status",id:"chat-status",children:"generating"===t?"生成中":"generated"===t?"生成完了":"入力待ち"})]}),(0,r.jsxs)("div",{className:"panel-content",style:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,r.jsx)(i,{messages:f}),(0,r.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"stretch",flexWrap:"wrap"},children:[(0,r.jsx)("textarea",{id:"prompt-input",placeholder:"業務フロー図を生成したい内容を入力してください。\n例: ECサイトの注文処理業務フローを描いて",value:s,onChange:e=>o(e.target.value),style:{flex:1,resize:"none",height:60,border:"2px solid rgba(209, 213, 219, 0.3)",borderRadius:12,padding:12,fontSize:14,background:"rgba(255, 255, 255, 0.9)",fontFamily:"inherit"}}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,r.jsxs)("button",{className:"btn btn-primary",id:"generate-btn",style:{height:32,padding:"6px 16px"},onClick:()=>{let e=s.trim();if(!e)return;let t={id:"user-".concat(Date.now()),role:"user",content:e,sentAt:new Date().toISOString()};p(e=>[...e,t]),d(e,u),o("")},children:[(0,r.jsx)("span",{id:"btn-text",children:"送信"}),(0,r.jsx)("div",{id:"btn-spinner",className:"loading-spinner",style:{display:"none"}})]}),(0,r.jsx)("button",{className:"btn btn-secondary",id:"clear-btn",style:{height:26,padding:"4px 12px",fontSize:12},onClick:()=>{n("inputWaiting"),c()},children:"クリア"})]})]}),(0,r.jsxs)("div",{className:"attachment-area",children:[(0,r.jsxs)("div",{className:"attachment-controls",children:[(0,r.jsxs)("div",{className:"attachment-label",children:[(0,r.jsx)("i",{className:"fas fa-paperclip"}),"添付ファイル"]}),(0,r.jsxs)("button",{className:"btn btn-ghost",id:"attach-btn",type:"button",onClick:()=>{var e;return null===(e=document.getElementById("file-input"))||void 0===e?void 0:e.click()},children:[(0,r.jsx)("i",{className:"fas fa-plus"}),"ファイルを選択"]}),(0,r.jsxs)("button",{type:"button",className:"attachment-hint-toggle","aria-expanded":h,onClick:()=>x(e=>!e),children:[(0,r.jsx)("i",{className:"fas fa-question-circle","aria-hidden":!0}),(0,r.jsx)("span",{className:"sr-only",children:"対応ファイル形式を表示"})]}),h?(0,r.jsx)("span",{className:"attachment-hint",children:"対応: .pdf /.txt / .md / .csv / .docx / .xls / .xlsx （最大2MB・複数可）"}):null,(0,r.jsx)("input",{type:"file",id:"file-input",multiple:!0,accept:".txt,.md,.csv,.pdf,.docx,.xls,.xlsx",style:{display:"none"},onChange:e=>g(e.target.files)})]}),(0,r.jsx)("div",{id:"attachment-list",className:"attachment-list ".concat(0===u.length?"empty":""),children:0===u.length?(0,r.jsx)("span",{className:"attachment-placeholder",children:"現在、添付ファイルはありません"}):u.map(e=>(0,r.jsxs)("div",{className:"attachment-item",children:[(0,r.jsx)("i",{className:"fas fa-file-alt","aria-hidden":!0}),(0,r.jsx)("div",{className:"attachment-name",title:e.file.name,children:e.file.name}),(0,r.jsx)("span",{className:"attachment-meta",children:y(e.file.size)}),(0,r.jsx)("button",{className:"attachment-remove",type:"button","aria-label":"".concat(e.file.name," を削除"),onClick:()=>w(e.id),children:(0,r.jsx)("i",{className:"fas fa-times","aria-hidden":!0})})]},e.id))})]})]})]})})}function o(e){let{agentState:t,drawioContent:n,canDownload:l,onDownload:i}=e,s=(0,a.useRef)(null),[o,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(null),m=(0,a.useRef)(!1),f=e=>{if(m.current||!e.includes("diagram"))return e;let t=function(e){let t=e.match(/^<\?xml[^>]*\?>\s*/);if(!t)return e;let n=t[0],r=e.slice(n.length);if(r.trimStart().startsWith("<mxfile"))return e;let a=r.replace(/^"[^"]*">\s*(?=<diagram)/,"");return"".concat(n).concat('<mxfile host="app.diagrams.net" modified="2025-01-24T00:00:00.000Z" agent="Claude" version="24.7.8">').concat(a)}(e);return m.current=!0,t};return(0,a.useEffect)(()=>{if(!n){m.current=!1,c("");return}c(f(n))},[n]),(0,a.useEffect)(()=>{let e=window;e.mxGraph&&e.mxCodec&&e.mxUtils&&u({mxGraph:e.mxGraph,mxCodec:e.mxCodec,mxUtils:e.mxUtils})},[]),(0,a.useEffect)(()=>{if(!o||o.length<200||!s.current){s.current&&(s.current.innerText="生成された業務フロー図がここに表示されます...");return}if(!d){s.current.innerText="mxGraphが利用できません";return}let{mxGraph:e,mxCodec:t,mxUtils:n}=d;s.current.innerHTML='<div style="width:100%;height:100%;min-height:800px;background:#fff;"></div>';let r=s.current.firstElementChild;if(!r)return;let a=new DOMParser().parseFromString(function(e){let t=e,n=t.indexOf("<?xml");-1===n?t='<?xml version="1.0" encoding="UTF-8"?>\n'+t:n>0&&(t=t.slice(n));let r=t.lastIndexOf("</mxCell>");return -1!==r&&(t=t.slice(0,r+9)),["</root>","</mxGraphModel>","</diagram>","</mxfile>"].forEach(e=>{t.includes(e)||(t+=e)}),t}(o),"text/xml"),l=new e(r);l.setEnabled(!1);let i=new t,c=a.documentElement.querySelector("diagram"),u=(null==c?void 0:c.querySelector("mxGraphModel"))||a.querySelector("mxGraphModel");if(u)i.decode(u,l.getModel());else if(null==c?void 0:c.textContent)try{let e=n.decompress(c.textContent),t=n.parseXml(e);i.decode(t.documentElement,l.getModel())}catch(e){}try{l.fit()}catch(e){}try{var m;let e=null===(m=s.current)||void 0===m?void 0:m.querySelector("svg");e&&(e.setAttribute("width","100%"),e.style.width="100%",e.style.height="auto",e.setAttribute("preserveAspectRatio","xMinYMin meet"))}catch(e){}},[o,d]),(0,r.jsxs)("div",{className:"panel",id:"diagram-panel",children:[(0,r.jsxs)("div",{className:"panel-header",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("i",{className:"fas fa-project-diagram"})," フロー図"]}),(0,r.jsx)("span",{className:"panel-status",id:"diagram-status",children:"generating"===t?"生成中":"generated"===t?"生成完了":"待機中"})]}),(0,r.jsxs)("div",{className:"panel-content",style:{display:"flex",flexDirection:"column",padding:0,height:"auto",minHeight:0},children:[(0,r.jsxs)("button",{className:"download-diagram-btn",id:"download-svg-btn",title:"drawioファイルをダウンロード",disabled:!l,onClick:i,children:[(0,r.jsx)("i",{className:"fas fa-download"}),(0,r.jsx)("span",{children:"ダウンロード"}),(0,r.jsx)("div",{className:"download-tooltip",children:"ダウンロードしました！"})]}),(0,r.jsx)("div",{id:"flow-diagram",ref:s,className:"placeholder",style:{flex:1,minHeight:0,width:"100%",maxWidth:"100%",overflowY:"auto",overflowX:"auto",whiteSpace:"pre-wrap",padding:0},children:"生成された業務フロー図がここに表示されます..."})]})]})}function c(){return(0,r.jsx)("div",{id:"prompt-modal",className:"prompt-modal",children:(0,r.jsxs)("div",{className:"prompt-modal-content",children:[(0,r.jsxs)("div",{className:"prompt-modal-header",children:[(0,r.jsx)("h3",{className:"prompt-modal-title",children:"実際のプロンプト詳細"}),(0,r.jsx)("button",{className:"prompt-modal-close",id:"prompt-modal-close",children:(0,r.jsx)("i",{className:"fas fa-times"})})]}),(0,r.jsx)("div",{className:"prompt-modal-body",id:"prompt-modal-body"})]})})}function d(e){let{onMouseDown:t}=e;return(0,r.jsx)("div",{id:"vertical-resizer",className:"vertical-resizer",role:"separator","aria-label":"左右リサイズ","aria-orientation":"vertical",onMouseDown:t})}var u=n(1266);function m(){let[e,t]=(0,a.useState)("inputWaiting"),[n,l]=(0,a.useState)(""),[i,m]=(0,a.useState)(""),[f]=(0,a.useState)(()=>"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"flow-"+Math.random().toString(36).slice(2)),[p,h]=(0,a.useState)([]),x=(0,a.useRef)(!1),g=(0,a.useRef)(!1),w=(0,a.useRef)(""),y=(0,a.useRef)(null),{leftPanelWidth:v,containerRef:b,handleMouseDown:j}=function(){let[e,t]=(0,a.useState)(480),n=(0,a.useRef)(null),r=(0,a.useRef)(null),l=(0,a.useRef)(!1),i=(0,a.useCallback)(e=>{if(!r.current||!n.current)return;let{startX:a,startWidth:l}=r.current;t(Math.min(Math.max(l+(e.clientX-a),320),n.current.getBoundingClientRect().width-320)),document.body.classList.add("is-resizing")},[]),s=(0,a.useCallback)(()=>{r.current=null,document.body.classList.remove("is-resizing"),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",s)},[i]),o=(0,a.useCallback)(t=>{n.current&&(r.current={startX:t.clientX,startWidth:e},window.addEventListener("mousemove",i),window.addEventListener("mouseup",s))},[e,i,s]);return(0,a.useEffect)(()=>{var e;if(l.current)return;let r=null===(e=n.current)||void 0===e?void 0:e.getBoundingClientRect().width;r&&(t(Math.min(Math.max(r/3,320),r-320)),l.current=!0)},[]),(0,a.useEffect)(()=>()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",s)},[i,s]),{leftPanelWidth:e,containerRef:n,handleMouseDown:o}}(),N=(0,a.useCallback)(e=>{if(x.current)return e;let t=e.indexOf("<?xml");return -1===t?null:(x.current=!0,e.slice(t))},[]),C=(0,a.useCallback)(e=>{let t=e.indexOf("</mxfile>");return -1!==t?(g.current=!0,e.slice(0,t+9)):e},[]),E=(0,a.useCallback)(()=>{m(w.current),y.current=null},[]);(0,a.useEffect)(()=>{i&&console.log("drawioContent updated in GenerateFlow",i)},[i]);let S=(0,a.useCallback)(()=>{null===y.current&&(y.current=window.setTimeout(E,200))},[E]),k=(0,a.useCallback)(e=>{if(g.current)return;w.current+=e;let t=N(w.current);if(null===t){w.current=w.current.slice(-200);return}w.current=t,w.current=C(w.current),w.current&&S()},[C,N,S]),R=(0,a.useCallback)(e=>e&&0!==e.length?e.map((e,t)=>"#".concat(t+1,": ").concat(e.file.name,"\nencoding: ").concat(e.encoding,"\n").concat(e.content)).join("\n\n"):"",[]),D=(0,a.useCallback)(async(e,n)=>{t("generating"),m(""),x.current=!1,g.current=!1,w.current="",null!==y.current&&(clearTimeout(y.current),y.current=null);try{var r;let a=R(n),l=a?"".concat(e,"\n\n--- 添付ファイル ---\n").concat(a):e,i=await fetch(u.b.messages(f),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_prompt:l,streaming:!0,use_agent_mode:!0})});if(!i.ok||!i.body)throw Error("HTTP ".concat(i.status));let s=i.body.getReader(),o=new TextDecoder,c="";for(;;){let{done:e,value:n}=await s.read();if(e)break;let a=(c+=o.decode(n,{stream:!0})).split("\n");for(let e of(c=null!==(r=a.pop())&&void 0!==r?r:"",a))if(e.trim())try{let n=JSON.parse(e);"content"===n.type&&"string"==typeof n.text&&k(n.text),"complete"===n.type&&"string"==typeof n.fullContent&&(k(n.fullContent),E(),t("generated"))}catch(e){console.warn("ストリームイベントのパースに失敗しました",e)}}}catch(e){console.error("API呼び出しに失敗しました",e),t("inputWaiting")}},[f,k,E]),L=(0,a.useCallback)(()=>{if(!i)return;let e=new Blob([i],{type:"application/xml;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="flow.drawio",n.click(),URL.revokeObjectURL(t)},[i]);(0,a.useEffect)(()=>()=>{null!==y.current&&clearTimeout(y.current)},[]);let T=(0,a.useCallback)(()=>{l(""),h([]),m(""),x.current=!1,g.current=!1,w.current="",null!==y.current&&(clearTimeout(y.current),y.current=null)},[]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"demo-container",ref:b,children:[(0,r.jsx)("div",{className:"left-panel",style:{width:v},children:(0,r.jsx)(s,{agentState:e,setAgentState:t,prompt:n,onPromptChange:l,onClear:T,onGenerate:D,attachments:p,onAttachmentsChange:h})}),(0,r.jsx)(d,{onMouseDown:j}),(0,r.jsx)("div",{style:{flex:1,minWidth:0},children:(0,r.jsx)(o,{agentState:e,drawioContent:i,canDownload:"generated"===e&&!!i,onDownload:L})})]}),(0,r.jsx)(c,{})]})}},4484:function(e,t,n){"use strict";n.d(t,{z1:function(){return u}});var r=n(9315),a=n.n(r),l=n(7800);let i=/\.(txt|md|csv|json|xml|drawio|plantuml|pu|uml|svg)$/i,s=/\.docx$/i,o=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel.sheet.macroenabled.12"],c=/\.(xlsx|xlsm|xls)$/i,d=null;async function u(e){return e&&("application/vnd.openxmlformats-officedocument.wordprocessingml.document"===(e.type||"").toLowerCase()||s.test(e.name||""))?{content:await m(e),encoding:"text"}:!function(e){if(!e)return!1;let t=(e.type||"").toLowerCase();return!!o.includes(t)||c.test(e.name||"")}(e)?e&&("application/pdf"===(e.type||"").toLowerCase()||/\.pdf$/i.test(e.name||""))?{content:await p(e),encoding:"text"}:new Promise((t,n)=>{let r=new FileReader,a=function(e){if(!e)return!1;let t=e.type||"";return!!(t.startsWith("text/")||["application/json","application/xml","text/xml","image/svg+xml"].includes(t))||i.test(e.name||"")}(e);r.onload=()=>{let e=r.result||"";if(a){t({content:"string"==typeof e?e:"",encoding:"text"});return}t({content:"string"==typeof e&&e.split(",")[1]||"",encoding:"base64"})},r.onerror=()=>{n(r.error||Error("ファイル読み込みに失敗しました"))},a?r.readAsText(e):r.readAsDataURL(e)}):{content:await f(e),encoding:"text"}}async function m(e){let t=await e.arrayBuffer(),n=(await a().loadAsync(t)).file("word/document.xml");if(!n)throw Error("Wordファイルの本文（word/document.xml）が見つかりませんでした");let r=await n.async("text"),l=new DOMParser().parseFromString(r,"application/xml");if(l.getElementsByTagName("parsererror").length>0)throw Error("WordファイルのXML解析に失敗しました");let i=Array.from(l.getElementsByTagName("w:p")).map(e=>(function(e){let t=[];return Array.from(e.childNodes).forEach(e=>{var n;if(e.nodeType!==Node.ELEMENT_NODE)return;let r=null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase();if("w:r"===r){Array.from(e.getElementsByTagName("w:t")).forEach(e=>{e.textContent&&t.push(e.textContent)});let n=e.getElementsByTagName("w:br");n.length>0&&t.push("\n".repeat(n.length))}else"w:tab"===r?t.push("	"):"w:br"===r&&t.push("\n")}),t.join("").replace(/\t/g,"    ")})(e)).map(e=>e.replace(/\s+$/u,"")).join("\n").replace(/\n{3,}/g,"\n\n").trim();if(!i)throw Error("Wordファイルからテキストを抽出できませんでした。");return i}async function f(e){let t=await e.arrayBuffer(),n=l.ij(t,{type:"array"});if(!n.SheetNames||0===n.SheetNames.length)throw Error("Excelファイルにシートが見つかりませんでした。");let r=n.SheetNames.map(e=>{let t=n.Sheets[e];if(!t)return null;let r=l.P6.sheet_to_json(t,{header:1,raw:!1});if(!r.length)return"【シート: ".concat(e,"】\n(空のシート)");let a=r.map(e=>(e||[]).map(e=>(function(e){if(null==e)return"";if(e instanceof Date)return e.toISOString();if("number"==typeof e||"boolean"==typeof e)return String(e);if("string"==typeof e)return e.replace(/\s+/g," ").trim();if("object"==typeof e)try{return JSON.stringify(e)}catch(e){}return""})(e)).join("	").trimEnd()).join("\n");return"【シート: ".concat(e,"】\n").concat(a)}).filter(Boolean).join("\n\n").trim();if(!r)throw Error("Excelファイルからテキストを抽出できませんでした。");return r}async function p(e){let t=await h(),n=await e.arrayBuffer();console.log("data"),console.log(n);let r=t.getDocument({data:n}),a=await r.promise;console.log("pdfDocument"),console.log(a);let l=[];for(let e=1;e<=a.numPages;e+=1){let t=await a.getPage(e),n=(await t.getTextContent()).items.map(e=>"str"in e?e.str:"").join(" ").trim();n&&l.push(n)}let i=l.join("\n\n").trim();if(!i)throw Error("PDFからテキストを抽出できませんでした。画像ベースのpdfは非対応です。pdf view等でpdf内の文字列をテキストとして認識できること（=テキストベースのpdf）を確認してください。）");return i}async function h(){return d||(d=n.e(634).then(n.bind(n,2392)).then(e=>{if("undefined"!=typeof Worker&&(null==e?void 0:e.GlobalWorkerOptions))try{let t=e.GlobalWorkerOptions;t.workerPort||(t.workerPort=new Worker(n.tu(new URL(n.p+n.u(357),n.b)),{type:void 0}))}catch(e){console.warn("PDF worker 初期化に失敗しました:",e)}return e})),d}},1266:function(e,t,n){"use strict";var r;n.d(t,{b:function(){return l}});let a=(null===(r=n(357).env.NEXT_PUBLIC_PROXY_BASE_URL)||void 0===r?void 0:r.replace(/\/$/,""))||"",l={health:"".concat(a,"/health"),messages:e=>"".concat(a,"/sessions/").concat(e,"/flows"),messagesBatch:"".concat(a,"/api/claude/messages-batch")}}},function(e){e.O(0,[425,315,971,23,744],function(){return e(e.s=6954)}),_N_E=e.O()}]);